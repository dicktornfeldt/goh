{% set user_id = current_user.ID %}

{% set attenders = raid.meta('attendance_list') %}

{% set attende_status = 'Nej' %}

{% for attende in attenders %}
  {% if attende.anvandare.ID == user_id %}
    {% set attende_status = attende.narvaro %}
  {% endif %}
{% endfor %}

<article class="RaidCard RaidCard__status--{{attende_status}}">
  <small class="RaidCard__date">{{ raid.datetime }}</small>
  <h3 class="RaidCard__title">{{ raid.title }} -
  {% if attende_status == 'Ja' %}
  Du är signad 🤘
  {% elseif attende_status == 'Kanske' %}
  Du är satt som kanske 🤞
  {% else %}
  Du är inte reggad 👎
  {% endif %}
  </h3>

  <form class="Form ajax-set-attendance" action="#" method="post">
    <input type="hidden" name="action" value="set_user_attendance">
    <input type="hidden" name="raid_id" value="{{ raid.id }}">
    <input type="hidden" name="user_id" value="{{ current_user.ID }}">
    <div class="Form__inputwrapper">
      <label for="user_attendance">Ska du med?</label>
      <select name="user_attendance" required>
        <option value="">Kommer du?</option>
        <option value="Nej">Nej</option>
        <option value="Kanske">Kanske</option>
        <option value="Ja">Ja</option>
      </select>
    </div>
  </form>

  <div class="RaidCard__buttonwrap">
    <button class="Button--small js-show-attendance">Vilka är på?</button>
  </div>

  <aside class="RaidCard__roster">

  {# this is for counting roles #}
  {% set healers = 0 %}
  {% set tanks = 0 %}
  {% set dps = 0 %}

  {% for attende in attenders %}
    {% if 'Healer' in attende.anvandare.role %}
      {% set healers = healers + 1 %}
    {% endif %}
    {% if 'Tank' in attende.anvandare.role %}
      {% set tanks = tanks + 1 %}
    {% endif %}
    {% if 'DPS' in attende.anvandare.role %}
      {% set dps = dps + 1 %}
    {% endif %}
  {% endfor %}

  <p class="RaidCard__rolecount">
   {{ tanks }} tanks,
   {{ dps }} dps,
   {{ healers }} healers
  </p>

  <div class="RaidCard__classlistwrap">

    <ul class="RaidCard__classlist">
      <strong><li>Tanks:</li></strong>
      {% for attende in attenders %}
      {% if 'Tank' in attende.anvandare.role and 'Warrior' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'Tank' in attende.anvandare.role and 'Druid' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>DPS:</li></strong>
      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Warrior' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Hunter' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Druid' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Priest' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Mage' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Warlock' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Rogue' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'DPS' in attende.anvandare.role and 'Shaman' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Healers:</li></strong>
      {% for attende in attenders %}
      {% if 'Healer' in attende.anvandare.role and 'Druid' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'Healer' in attende.anvandare.role and 'Priest' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}

      {% for attende in attenders %}
      {% if 'Healer' in attende.anvandare.role and 'Shaman' in attende.anvandare.class  %}
      <li>{{attende.signup_number}}. {{attende.anvandare.nick}} <em>{{attende.anvandare.class}} {{attende.narvaro == 'Kanske' ? '- kanske' : ''}}</em></li>
      {% endif %}
      {% endfor %}
    </ul>
{#
    <ul class="RaidCard__classlist">
      <strong><li>Warriors:</li></strong>
      {% for attende in attenders %}
      {% if 'Warrior' in attende.class %}
      <li class="warrior">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Druids:</li></strong>
      {% for attende in attenders %}
      {% if 'Druid' in attende.class %}
      <li class="Druid">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Warlocks:</li></strong>
      {% for attende in attenders %}
      {% if 'Warlock' in attende.class %}
      <li class="Warlock">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Hunters:</li></strong>
      {% for attende in attenders %}
      {% if 'Hunter' in attende.class %}
      <li class="Hunter">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Mages:</li></strong>
      {% for attende in attenders %}
      {% if 'Mage' in attende.class %}
      <li class="Mage">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Rogues:</li></strong>
      {% for attende in attenders %}
      {% if 'Rogue' in attende.class %}
      <li class="Rogue">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Shamans:</li></strong>
      {% for attende in attenders %}
      {% if 'Shaman' in attende.class %}
      <li class="Shaman">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul>

    <ul class="RaidCard__classlist">
      <strong><li>Priests:</li></strong>
      {% for attende in attenders %}
      {% if 'Priest' in attende.class %}
      <li class="Priest">
        {{attende.nick}} <em>{{attende.role}}</em>
      </li>
      {% endif %}
      {% endfor %}
    </ul> #}

  </div>


  </aside>

</article>
